<!DOCTYPE html>
<html lang="zh-Hant" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>正弦波前進模擬 - 國中自然科學模擬動畫</title>
  <meta name="description" content="互動式正弦波前進模擬，觀察橫波的傳播與質點振動" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../assets/css/common.css" />
  <link rel="stylesheet" href="../assets/css/accessibility.css" />
</head>
<body>
    <a href="#main" class="skip-link">跳到主內容</a>
    
  <!-- 動態導覽列容器 -->
  <div id="navbarContainer"></div>

    <main id="main" class="container my-4 flex-grow-1" tabindex="-1">
        <div class="row g-4">
            
            <!-- 左側：模擬畫布 -->
            <div class="col-12 col-lg-8">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h1 class="h3 card-title mb-3">
                            <i class="fa-solid fa-water" aria-hidden="true"></i>
                            正弦波前進模擬
                        </h1>
                        <p class="card-text">
                            觀察正弦波（橫波）的傳播過程。紅點代表介質中的質點，只做上下振動，波形本身則向前傳播。
                        </p>
                        
                        <!-- 即時狀態通知 -->
                        <div id="statusRegion" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
                        
                        <!-- Canvas container for responsive sizing -->
                        <div class="canvas-container flex-grow-1">
                            <canvas id="waveCanvas" role="img" aria-label="正弦波動畫模擬"></canvas>
                        </div>
                        
                        <p class="small text-muted mt-3 mb-0">
                            <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                            垂直虛線代表固定位置，觀察紅點只做垂直振動，不隨波前進。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 右側：控制面板 -->
            <div class="col-12 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h2 class="h5 card-title mb-3">控制面板</h2>
                        
                        <!-- 播放控制 -->
                        <div class="control-group mb-3">
                            <div class="d-grid gap-2">
                                <button id="playPauseBtn" class="btn btn-primary" type="button" aria-pressed="false">
                                    <i class="fa-solid fa-play" aria-hidden="true"></i>
                                    <span>開始</span>
                                </button>
                                <button id="resetBtn" class="btn btn-outline-secondary" type="button">
                                    <i class="fa-solid fa-rotate-right" aria-hidden="true"></i>
                                    重置
                                </button>
                            </div>
                        </div>

                        <!-- 速度控制 -->
                        <div class="control-group mb-3">
                            <label for="speedRange" class="form-label fw-semibold">
                                波速 (v)
                                <span id="speedValue" class="badge bg-primary ms-2">0.05</span>
                            </label>
                            <input type="range" class="form-range" id="speedRange" 
                                   min="0.01" max="0.2" step="0.01" value="0.05"
                                   aria-valuemin="0.01" aria-valuemax="0.2" aria-valuenow="0.05"
                                   aria-label="調整波速">
                        </div>

                        <!-- 頻率控制 -->
                        <div class="control-group mb-3">
                            <label for="frequencyRange" class="form-label fw-semibold">
                                頻率 (f)
                                <span id="frequencyValue" class="badge bg-success ms-2">3</span>
                            </label>
                            <input type="range" class="form-range" id="frequencyRange" 
                                   min="1" max="10" step="1" value="3"
                                   aria-valuemin="1" aria-valuemax="10" aria-valuenow="3"
                                   aria-label="調整頻率（畫面中的波數）">
                        </div>

                        <!-- 快捷鍵說明 -->
                        <div class="mb-3">
                            <button class="btn btn-outline-info btn-sm w-100" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#shortcutHelp" 
                                    aria-expanded="false" aria-controls="shortcutHelp">
                                <i class="fa-solid fa-keyboard" aria-hidden="true"></i> 快捷鍵說明
                            </button>
                            <div id="shortcutHelp" class="collapse mt-2">
                                <div class="card card-body small">
                                    <ul class="mb-0" aria-label="快捷鍵清單">
                                        <li><kbd>Space</kbd>：開始/暫停</li>
                                        <li><kbd>R</kbd>：重置</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- 理論說明 Accordion -->
                        <div class="accordion" id="theoryAccordion">
                            <div class="accordion-item">
                                <h3 class="accordion-header" id="headingFormula">
                                    <button class="accordion-button collapsed" type="button" 
                                            data-bs-toggle="collapse" data-bs-target="#panelFormula" 
                                            aria-expanded="false" aria-controls="panelFormula">
                                        波動公式
                                    </button>
                                </h3>
                                <div id="panelFormula" class="accordion-collapse collapse" 
                                     aria-labelledby="headingFormula" data-bs-parent="#theoryAccordion">
                                    <div class="accordion-body small">
                                        <p><strong>波速公式：</strong> v = f × λ</p>
                                        <ul class="mb-0">
                                            <li>v：波速 (m/s)</li>
                                            <li>f：頻率 (Hz)</li>
                                            <li>λ：波長 (m)</li>
                                        </ul>
                                        <p class="mt-2"><strong>位移公式：</strong> y = A sin(kx - ωt)</p>
                                        <ul class="mb-0">
                                            <li>A：振幅</li>
                                            <li>k：波數 = 2π/λ</li>
                                            <li>ω：角頻率 = 2πf</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h3 class="accordion-header" id="headingConcept">
                                    <button class="accordion-button collapsed" type="button" 
                                            data-bs-toggle="collapse" data-bs-target="#panelConcept" 
                                            aria-expanded="false" aria-controls="panelConcept">
                                        觀察重點
                                    </button>
                                </h3>
                                <div id="panelConcept" class="accordion-collapse collapse" 
                                     aria-labelledby="headingConcept" data-bs-parent="#theoryAccordion">
                                    <div class="accordion-body small">
                                        <ul class="mb-0">
                                            <li>紅點（質點）只做<strong>垂直振動</strong>，不會隨波前進</li>
                                            <li>波形本身向前傳播，這是<strong>能量的傳遞</strong></li>
                                            <li>頻率越高，波長越短（波數越多）</li>
                                            <li>波速越快，波形移動越快</li>
                                            <li>這是<strong>橫波</strong>：振動方向垂直於傳播方向</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- 動態頁尾容器 -->
    <div id="footerContainer"></div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- App Scripts -->
    <script type="module">
        import { initThemeToggle } from '../assets/js/theme.js';
        import { loadNavigation } from '../assets/js/navigation.js';
        import { createLiveRegion } from '../assets/js/a11y.js';

        // Page Initialization
        async function initPage() {
            try {
                // Load shared navigation and footer
                await loadNavigation({
                    baseUrl: '..',
                    navbarPath: '../assets/templates/navbar.html',
                    footerPath: '../assets/templates/footer.html'
                });

                // Initialize theme toggle functionality
                initThemeToggle();

                // Create a live region for screen reader announcements
                const statusRegion = document.getElementById('statusRegion');
                window.announceStatus = createLiveRegion(statusRegion).announce;
                
                // Dynamically load the animation script
                const animationScript = document.createElement('script');
                animationScript.src = 'sine-wave-animation.js'; // Ensure correct path
                animationScript.onload = () => {
                    if (window.initAnimation) {
                        window.initAnimation();
                        window.announceStatus('正弦波前進模擬已載入，並準備就緒。');
                    } else {
                        console.error('Animation initialization function not found.');
                        window.announceStatus('動畫載入失敗。');
                    }
                };
                animationScript.onerror = () => {
                    console.error('Failed to load sine-wave-animation.js');
                    window.announceStatus('動畫腳本載入失敗。');
                };
                document.body.appendChild(animationScript);

            } catch (error) {
                console.error('Page initialization failed:', error);
            }
        }

        // Run the initialization
        initPage();
    </script>
</body>
</html>
